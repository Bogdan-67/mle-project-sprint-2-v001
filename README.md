# Предсказание цен на недвижимость (Real Estate Price Prediction)

## Описание проекта
Данный проект посвящен разработке модели машинного обучения для предсказания стоимости квартир (задача регрессии). Основная цель — построить модель, способную с высокой точностью оценивать рыночную стоимость недвижимости на основе её характеристик (площадь, этажность, расположение, тип дома и т.д.).

В проекте реализован полный цикл Data Science: от подключения к базе данных и разведочного анализа до автоматической генерации признаков, их отбора и оптимизации гиперпараметров финальной модели. Все эксперименты и артефакты логируются с помощью MLflow.

### Использованные технологии и библиотеки:
*   **Язык:** Python 3.9+
*   **Обработка данных:** Pandas, NumPy, PostgreSQL (psycopg2)
*   **Визуализация:** Matplotlib, Seaborn
*   **ML & Preprocessing:** Scikit-learn, CatBoost
*   **Feature Engineering:** Featuretools, Autofeat
*   **Experiment Tracking:** MLflow
*   **Optimization:** Optuna

Имя бакета: `s3-student-mle-20251120-23dfed9b96`

---

## Установка и запуск

Для запуска проекта на локальной машине выполните следующие шаги:

### 1. Клонирование репозитория
Склонируйте репозиторий к себе на компьютер:

```bash
git clone https://github.com/Bogdan-67/mle-project-sprint-2-v001.git
cd mle-project-sprint-2-v001
```

### 2. Создание виртуального окружения (рекомендуется)
Создайте и активируйте виртуальное окружение, чтобы избежать конфликтов версий библиотек:

```bash
# Для Linux/macOS
python3 -m venv venv
source venv/bin/activate

# Для Windows
python -m venv venv
.\venv\Scripts\activate
```

### 3. Установка зависимостей
Установите необходимые библиотеки из файла `requirements.txt`:

```bash
pip install -r requirements.txt
```

### 4. Настройка окружения
Проект использует переменные окружения для подключения к базе данных и MLflow. Создайте файл `.env` в корне проекта и заполните его по шаблону:

```env
# Database connection
DB_DESTINATION_HOST=your_db_host
DB_DESTINATION_PORT=your_db_port
DB_DESTINATION_NAME=your_db_name
DB_DESTINATION_USER=your_db_user
DB_DESTINATION_PASSWORD=your_db_password

# S3
S3_BUCKET_NAME=your_s3_bucket_name
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
MLFLOW_S3_ENDPOINT_URL=your_mlflow_s3_endpoint_url

# MLflow configuration
TRACKING_SERVER_HOST=your_mlflow_host
TRACKING_SERVER_PORT=your_mlflow_port
EXPERIMENT_NAME=real_estate_prices
```

### 5. Запуск
Запустите Jupyter Notebook или конвертированный скрипт для выполнения пайплайна обучения:

```bash
jupyter notebook real_estate_research.ipynb
```

---

## Руководство по этапам проекта

Проект разделен на 5 последовательных этапов, каждый из которых решает конкретную задачу улучшения модели.

### Этап 1: Подготовка среды
*Настройка инфраструктуры (выполнено предварительно).*
*   Настройка подключения к PostgreSQL для загрузки "чистых" данных.
*   Развертывание и конфигурация MLflow Tracking Server для логирования экспериментов, параметров и моделей.

### Этап 2: Исследовательский Анализ Данных (EDA)
Глубокое погружение в данные для понимания их структуры и выявления закономерностей.
*   **Анализ распределений:** Изучение целевой переменной (`price`) и ключевых признаков (площадь, этажность, год постройки).
*   **Работа с выбросами и аномалиями:** Выявление квартир-студий (нулевая жилая площадь), анализ высоты потолков.
*   **Гео-анализ:** Визуализация распределения цен в зависимости от координат и расстояния до центра.
*   **Корреляционный анализ:** Построение матриц корреляции (Пирсона и Спирмена) для выявления линейных и нелинейных связей.
*   *Результат:* Сформированы гипотезы о влиянии местоположения, типа дома и этажности на цену.

### Этап 3: Генерация Признаков и Обучение Модели
Создание новых признаков для повышения информативности датасета.
*   **Ручная генерация:**
    *   Расчет расстояния до центра (формула Гаверсинуса).
    *   Маркировка исторических зданий (возраст + локация).
    *   Создание ценовых категорий по высоте потолков.
*   **Автоматическая генерация:**
    *   Использование **Featuretools** для создания агрегированных признаков (EntitySet).
    *   Использование **Autofeat** для генерации нелинейных признаков (логарифмы, корни и т.д.).
*   **Пайплайн:** Все преобразования обернуты в `sklearn.Pipeline` и `ColumnTransformer`.
*   *Результат:* Обучена базовая модель CatBoost на расширенном наборе признаков.

### Этап 4: Отбор Признаков и Обучение Модели
Удаление избыточных и "шумных" признаков для ускорения модели и предотвращения переобучения.
*   **Sequential Forward Selection (SFS):** Пошаговое добавление признаков, улучшающих метрику MAE.
*   **Recursive Feature Elimination (RFE):** Рекурсивное удаление наименее важных признаков.
*   **Сравнение:** Анализ пересечения наборов признаков от двух методов.
*   *Результат:* Выбран оптимальный набор из 15 признаков, который сохраняет качество модели, но ускоряет обучение и предсказание в 7 раз.

### Этап 5: Подбор Гиперпараметров и Финальная Модель
Тонкая настройка модели для достижения максимальной точности.
*   **Random Search:** Случайный поиск по сетке параметров для грубой оценки.
*   **Optuna:** Байесовская оптимизация гиперпараметров (learning rate, depth, l2_leaf_reg и др.) с использованием `TPESampler`.
*   **Финальное обучение:** Обучение модели с лучшими найденными параметрами на всей обучающей выборке.
*   **Оценка:** Проверка качества на отложенной тестовой выборке (Test Set).
*   *Результат:* Финальная модель сохранена в MLflow Registry, метрики (MAE, RMSE, R2) зафиксированы.